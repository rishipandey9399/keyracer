<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Editor Test</title>
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .editor-container {
            position: relative;
            height: 400px;
            background: #1e1e1e;
            border-radius: 8px;
            border: 1px solid #2d3f60;
            margin: 20px 0;
        }
        
        .code-input {
            width: 100%;
            height: 400px;
            background: transparent;
            border: none;
            padding: 1rem;
            color: #d4d4d4;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            resize: none;
            line-height: 1.5;
            tab-size: 4;
            outline: none;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
        }
        
        .code-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: #d4d4d4;
            background: #1e1e1e;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            z-index: 1;
            overflow: auto;
        }
        
        .test-info {
            background: #2d3f60;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Code Editor Features Test</h1>
        
        <div class="test-info">
            <h3>Test the following features:</h3>
            <ul>
                <li>‚ú® <strong>Syntax Highlighting:</strong> Type Python keywords like <code>def</code>, <code>if</code>, <code>print</code></li>
                <li>üîó <strong>Auto-closing brackets:</strong> Type <code>(</code>, <code>[</code>, <code>{</code>, <code>"</code>, <code>'</code></li>
                <li>üìù <strong>Tab indentation:</strong> Press Tab for 4-space indentation</li>
                <li>‚èé <strong>Smart Enter:</strong> Press Enter after a colon <code>:</code> for auto-indent</li>
            </ul>
        </div>
        
        <div class="editor-container">
            <textarea class="code-input" placeholder="# Try typing some Python code here...
def hello_world():
    print('Hello, World!')
    
if True:
    hello_world()"></textarea>
            <div class="code-preview"></div>
        </div>
        
        <div class="test-info">
            <p><strong>Sample code to test:</strong></p>
            <pre>def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print("Result:", fibonacci(10))</pre>
        </div>
    </div>

    <script>
        // Enhanced code editor with syntax highlighting and auto-closing brackets
        class CodeEditor {
            constructor(textarea, preview) {
                this.textarea = textarea;
                this.preview = preview;
                this.init();
            }

            init() {
                // Set initial content
                this.updateHighlighting();
                
                // Add event listeners
                this.textarea.addEventListener('input', () => this.updateHighlighting());
                this.textarea.addEventListener('keydown', (e) => this.handleKeyDown(e));
                this.textarea.addEventListener('scroll', () => this.syncScroll());
                
                console.log('CodeEditor initialized successfully');
            }

            updateHighlighting() {
                const code = this.textarea.value;
                const highlightedCode = this.highlightPython(code);
                this.preview.innerHTML = highlightedCode;
            }

            syncScroll() {
                this.preview.scrollTop = this.textarea.scrollTop;
                this.preview.scrollLeft = this.textarea.scrollLeft;
            }

            handleKeyDown(e) {
                const pairs = {
                    '(': ')',
                    '[': ']',
                    '{': '}',
                    '"': '"',
                    "'": "'"
                };

                if (pairs[e.key]) {
                    e.preventDefault();
                    this.insertPair(e.key, pairs[e.key]);
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    this.insertTab();
                } else if (e.key === 'Enter') {
                    this.handleEnter(e);
                }
            }

            insertPair(open, close) {
                const start = this.textarea.selectionStart;
                const end = this.textarea.selectionEnd;
                const text = this.textarea.value;
                const before = text.substring(0, start);
                const selected = text.substring(start, end);
                const after = text.substring(end);

                this.textarea.value = before + open + selected + close + after;
                this.textarea.selectionStart = this.textarea.selectionEnd = start + 1;
                this.updateHighlighting();
            }

            insertTab() {
                const start = this.textarea.selectionStart;
                const end = this.textarea.selectionEnd;
                const text = this.textarea.value;
                const before = text.substring(0, start);
                const after = text.substring(end);

                this.textarea.value = before + '    ' + after;
                this.textarea.selectionStart = this.textarea.selectionEnd = start + 4;
                this.updateHighlighting();
            }

            handleEnter(e) {
                const start = this.textarea.selectionStart;
                const text = this.textarea.value;
                const lines = text.substring(0, start).split('\n');
                const currentLine = lines[lines.length - 1];
                
                // Calculate indentation
                const indent = currentLine.match(/^(\s*)/)[1];
                let newIndent = indent;
                
                // Add extra indentation after colons
                if (currentLine.trim().endsWith(':')) {
                    newIndent += '    ';
                }

                setTimeout(() => {
                    const newStart = this.textarea.selectionStart;
                    const newText = this.textarea.value;
                    const beforeCursor = newText.substring(0, newStart);
                    const afterCursor = newText.substring(newStart);
                    
                    this.textarea.value = beforeCursor + newIndent + afterCursor;
                    this.textarea.selectionStart = this.textarea.selectionEnd = newStart + newIndent.length;
                    this.updateHighlighting();
                }, 0);
            }

            highlightPython(code) {
                // Simple Python syntax highlighting
                let highlighted = code;
                
                // Escape HTML characters first
                highlighted = highlighted.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                // Keywords
                const keywords = ['def', 'class', 'if', 'elif', 'else', 'for', 'while', 'try', 'except', 'finally', 'with', 'import', 'from', 'as', 'return', 'yield', 'break', 'continue', 'pass', 'lambda', 'and', 'or', 'not', 'in', 'is', 'True', 'False', 'None'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b${keyword}\\b`, 'g');
                    highlighted = highlighted.replace(regex, `<span style="color: #569cd6;">${keyword}</span>`);
                });

                // Strings (double quotes)
                highlighted = highlighted.replace(/"([^"\\]|\\.)*"/g, '<span style="color: #ce9178;">$&</span>');
                // Strings (single quotes)
                highlighted = highlighted.replace(/'([^'\\]|\\.)*'/g, '<span style="color: #ce9178;">$&</span>');

                // Comments
                highlighted = highlighted.replace(/#.*/g, '<span style="color: #6a9955;">$&</span>');

                // Numbers
                highlighted = highlighted.replace(/\b\d+(\.\d+)?\b/g, '<span style="color: #b5cea8;">$&</span>');

                // Functions (before built-ins to avoid conflicts)
                highlighted = highlighted.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g, '<span style="color: #dcdcaa;">$1</span>');

                // Built-in functions (override function coloring for built-ins)
                const builtins = ['print', 'len', 'range', 'str', 'int', 'float', 'list', 'dict', 'set', 'tuple', 'type', 'input', 'open'];
                builtins.forEach(builtin => {
                    const regex = new RegExp(`<span style="color: #dcdcaa;">${builtin}</span>`, 'g');
                    highlighted = highlighted.replace(regex, `<span style="color: #4ec9b0;">${builtin}</span>`);
                });

                return highlighted;
            }
        }

        // Initialize the code editor when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing code editor...');
            
            const textarea = document.querySelector('.code-input');
            const preview = document.querySelector('.code-preview');
            
            if (textarea && preview) {
                const editor = new CodeEditor(textarea, preview);
                console.log('Code editor created successfully');
            } else {
                console.error('Could not find textarea or preview elements');
            }
        });
    </script>
</body>
</html>
